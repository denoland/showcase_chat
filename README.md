## `showcase_chat`

A minimal chat platform template. It uses [Fresh](https://fresh.deno.dev) +
[Supabase](https://supabase.io) + [twind](https://twind.dev) +
[BroadcastChannel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API)
on Deno Deploy.

To get started, setup your `.env` with Supabase and Github OAuth credentials:


To setup a [Github OAuth App](https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps)

- Go to https://github.com/settings/applications/new
- Set `Application name` to `Deploy Chat Example`
- Set `Homepage URL` to your Deno Deploy project URL. (eg: `chat-app-example.deno.dev`)
- Set `Authorization callback URL` to `http://chat-app-example.deno.dev` or localhost for development.
- Paste `Client ID` and `Client Secret` in `.env`

To setup a Supabase project

```
CLIENT_ID=abc
CLIENT_SECRET=abc123
SUPABASE_ANON_KEY=xyz
SUPABASE_API_URL=https://xyzxyzxyzxyzxyzxyzxy.supabase.co
SUPABASE_DB_PASSWORD=xyz123
```

and fire up the server:

```
deno run -A --no-check main.ts
```

In supabase dashboard, go to the SQL editor and run this query:

```sql
create table users (
  id integer generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  login text,
  avatar_url text,
  access_token text
);

create table rooms (
  id integer generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  name text not null
);

create table messages (
  id integer generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  message text,
  "from" integer references users (id),
  "room" integer references rooms (id)
);

create view rooms_with_activity
as select
  rooms.id as id,
  rooms.name as name,
  max(messages.created_at) as last_message_at
from rooms
left join messages on messages.room = rooms.id
group by rooms.id
order by last_message_at desc nulls last;

insert into rooms (id, name) values (0, 'Lobby');
```
